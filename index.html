<script>
async function loadEvents() {
  try {
    const res = await fetch("/events");
    const data = await res.json();

    const container = document.getElementById("events");
    container.innerHTML = "";

    if (!data.length) {
      container.innerHTML = "Пока нет событий.";
      return;
    }

    // Новые события сверху
    data.reverse().forEach(ev => {
      const card = document.createElement("div");
      card.className = "event " + (ev.door === "Открыта" ? "open" : "close");

      const time = document.createElement("div");
      time.className = "event-time";

      // Преобразуем ISO в локальное время
      const date = new Date(ev.timestamp);
      const options = { 
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit' 
      };
      time.textContent = date.toLocaleString('ru-RU', options);

      const text = document.createElement("div");
      text.className = "event-text";
      text.textContent = "Дверь: " + ev.door;

      card.appendChild(time);
      card.appendChild(text);
      container.appendChild(card);
    });

  } catch (err) {
    document.getElementById("events").innerHTML =
      "Ошибка загрузки данных.";
  }
}

loadEvents();
setInterval(loadEvents, 3000);
</script>
